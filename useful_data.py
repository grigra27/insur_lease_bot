import pandas as pd

df = pd.read_csv('tariffs_online.csv', sep=';')


def search_in_our_base(search_phrase):
    """
    –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ø–æ–∏—Å–∫ –ø—Ä–µ–¥–º–µ—Ç–∞ –ª–∏–∑–∏–Ω–≥–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö.
    :param search_phrase: –°—Ç—Ä–æ–∫–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø–æ–∏—Å–∫
    :return: –°—Ç—Ä–æ–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å—è—Ö
    """
    used_df = df[df.property.str.contains(search_phrase, case=False)]
    if len(used_df) == 0:
        return f"–ü—Ä–µ–¥–º–µ—Ç –ª–∏–∑–∏–Ω–≥–∞ '{search_phrase}' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –Ω–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö."
    records_count = len(used_df)
    property_min = round((used_df.property_value.min()) / 1000000, 3)
    property_median = round((used_df.property_value.median()) / 1000000, 3)
    property_max = round((used_df.property_value.max()) / 1000000, 3)
    tarif_min = round(used_df.tarif.min(), 2)
    tarif_median = round(used_df.tarif.median(), 2)
    tarif_max = round(used_df.tarif.max(), 2)
    insurance_type = used_df.type.mode()[0]
    insurance_company = used_df.insurer.mode()[0]
    result_phrase = f"""
üîç *–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É:* _"{search_phrase}"_

üìÑ –ù–∞–π–¥–µ–Ω–æ *{records_count}* –∑–∞–ø–∏—Å{"—å" if records_count == 1 else "–∏"} –æ —Ç–∞–∫–æ–º –ø—Ä–µ–¥–º–µ—Ç–µ –ª–∏–∑–∏–Ω–≥–∞.

üí∞ *–¶–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–∞ –ª–∏–∑–∏–Ω–≥–∞:*
‚Ä¢ –ú–µ–¥–∏–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞: *{property_median} –º–ª–Ω ‚ÇΩ*
‚Ä¢ –î–∏–∞–ø–∞–∑–æ–Ω: –æ—Ç *{property_min} –º–ª–Ω ‚ÇΩ* –¥–æ *{property_max} –º–ª–Ω ‚ÇΩ*

üõ° *–°—Ç—Ä–∞—Ö–æ–≤–æ–π —Ç–∞—Ä–∏—Ñ:*
‚Ä¢ –ú–µ–¥–∏–∞–Ω–Ω—ã–π —Ç–∞—Ä–∏—Ñ: *{tarif_median}%*
‚Ä¢ –î–∏–∞–ø–∞–∑–æ–Ω: –æ—Ç *{tarif_min}%* –¥–æ *{tarif_max}%*

üè∑ –ß–∞—â–µ –≤—Å–µ–≥–æ —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –ª–∏–∑–∏–Ω–≥–∞ —Å—Ç—Ä–∞—Ö—É–µ—Ç—Å—è –∫–∞–∫: *"{insurance_type}"* 
üè¢ –ß–∞—â–µ –≤—Å–µ–≥–æ —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –ª–∏–∑–∏–Ω–≥–∞ —Å—Ç—Ä–∞—Ö—É–µ—Ç—Å—è –≤ —Å—Ç—Ä–∞—Ö–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏: *"{insurance_company}"*
"""

    result_phrase2 = f'''
–í—ã –∏—Å–∫–∞–ª–∏ –ø—Ä–µ–¥–º–µ—Ç –ª–∏–∑–∏–Ω–≥–∞ "{search_phrase}". –í –Ω–∞—à–µ–π –±–∞–∑–µ –Ω–∞–π–¥–µ–Ω–æ {records_count} –∑–∞–ø–∏—Å{"—å" if records_count == 1 else "–∏"} –æ —Ç–∞–∫–æ–º –ø—Ä–µ–¥–º–µ—Ç–µ –ª–∏–∑–∏–Ω–≥–∞.

–ú–µ–¥–∏–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–∞ –ª–∏–∑–∏–Ω–≥–∞ - {property_median} –º–ª–Ω —Ä. –†–∞–∑–±—Ä–æ—Å —Ü–µ–Ω –Ω–∞ —ç—Ç–æ –∏–º—É—â–µ—Å—Ç–≤–æ –æ—Ç {property_min} –º–ª–Ω —Ä. –¥–æ {property_max} –º–ª–Ω —Ä.
–ú–µ–¥–∏–∞–Ω–Ω—ã–π —Å—Ç—Ä–∞—Ö–æ–≤–æ–π —Ç–∞—Ä–∏—Ñ - {tarif_median}%. –†–∞–∑–±—Ä–æ—Å —Å—Ç—Ä–∞—Ö–æ–≤—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –æ—Ç {tarif_min}% –¥–æ {tarif_max}%.

–ß–∞—â–µ –≤—Å–µ–≥–æ —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –ª–∏–∑–∏–Ω–≥–∞ —Å—Ç—Ä–∞—Ö—É–µ—Ç—Å—è –∫–∞–∫ "{insurance_type}".
–ß–∞—â–µ –≤—Å–µ–≥–æ —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –ª–∏–∑–∏–Ω–≥–∞ —Å—Ç—Ä–∞—Ö—É–µ—Ç—Å—è –≤ —Å—Ç—Ä–∞—Ö–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ "{insurance_company}".
'''
    return result_phrase


def get_welcome_phrase():
    return f'–í—ã –º–æ–∂–µ—Ç–µ –ø–æ–∏—Å–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–∏ –ª–∏–∑–∏–Ω–≥–∞. –°–µ–π—á–∞—Å –≤ –±–∞–∑–µ {len(df)} –∑–∞–ø–∏—Å–µ–π –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö. –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å.'