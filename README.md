# Telegram Bot for Leasing Insurance Search

Этот проект включает Telegram-бота для поиска информации о страховании лизинговых предметов с встроенной системой дайджестов.

## Компоненты проекта

### Основной бот (`bot.py`)
- Поиск информации о страховании лизинговых предметов по данным из `tariffs_online.csv`
- Логирование пользовательских запросов в `user_queries.log`
- Уведомления администратора о критических ошибках
- Встроенная система дайджестов (команда `/digest`)

## Запуск

### Локальный запуск
1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

2. Настройте переменные окружения в файле `.env`:
   ```
   TELEGRAM_BOT_TOKEN=your_main_bot_token
   ADMIN_TELEGRAM_USER_ID=your_admin_user_id
   ```

3. Запустите бота:
   ```bash
   python bot.py
   ```

### Запуск через Docker
1. Соберите образ:
   ```bash
   docker build -t insur-lease-bot .
   ```

2. Запустите через docker-compose:
   ```bash
   docker compose up -d
   ```

## Использование
- Отправьте любое слово или фразу — получите информацию по предмету лизинга из базы
- Команда `/start` — приветствие и краткая инструкция
- Команда `/help` — напоминание о функционале
- Команда `/digest` — отправка дайджеста админу (только для администратора)

## Структура проекта

### Основные файлы
- `bot.py` — основной код Telegram-бота с встроенными дайджестами
- `tariffs_online.csv` — база данных тарифов

### Конфигурация и развертывание
- `requirements.txt` — зависимости Python
- `Dockerfile` — конфигурация Docker-образа
- `docker-compose.yml` — настройки для запуска контейнеров
- `.env` — переменные окружения

### Вспомогательные файлы
- `secrets-examples.txt` — примеры конфигурации секретов
- `user_queries.log` — лог пользовательских запросов
- `tariffs_service_file.ipynb` — Jupyter notebook для анализа данных

## Зависимости
- python-telegram-bot — работа с Telegram Bot API
- pandas — обработка данных из CSV
- python-dotenv — загрузка переменных окружения

## CI/CD
Проект настроен для автоматического развертывания через GitHub Actions на Timeweb Cloud.

## Новые возможности

### Оптимизированная архитектура
- Единый контейнер вместо двух отдельных сервисов
- Кеширование данных CSV при запуске
- Встроенная система дайджестов

### Улучшенная надежность
- Healthcheck для мониторинга работоспособности
- Ротация логов (максимум 30MB, 3 файла)
- Улучшенная обработка ошибок
- Запуск от непривилегированного пользователя

### Упрощенное управление
- Команда `/digest` для ручной отправки дайджеста
- Автоматическое создание директорий для логов
- Упрощенный процесс деплоя без Docker Hub
